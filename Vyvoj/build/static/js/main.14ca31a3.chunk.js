(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{12:function(e,t,n){},15:function(e,t,n){e.exports=n(31)},23:function(e,t,n){},27:function(e,t,n){},29:function(e,t,n){},31:function(e,t,n){"use strict";n.r(t);var i=n(9),o=n.n(i),r=n(13),a=n.n(r),s=n(6),l=n.n(s),c=n(8),h=n(3),u=n.n(h);var d=n(0),p=n(2),m=n(4),v=n(1),f=n(5),y=n(7),w=function(){function e(){Object(d.a)(this,e),this._events={}}return Object(p.a)(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach(function(e){n._events[e]=n._events[e]||[],n._events[e].push(t)}),this}},{key:"off",value:function(e,t){var n=this;if(void 0!=e)return e.split(" ").forEach(function(e){e in n._events!==!1&&(t?n._events[e].splice(n._events[e].indexOf(t),1):n._events[e]=[])}),this;this._events={}}},{key:"emit",value:function(e){if(void 0!==this._events[e])for(var t=this._events[e].slice(),n=0;n<t.length;++n){var i=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==i)return i}}},{key:"guid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxxxx",t=(new Date).getTime(),n=e.replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return n}}]),e}();w.Composer=function(e){return function(e){function t(e,n,i,o,r){var a;return Object(d.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e,n,i,o,r)))._events={},a}return Object(f.a)(t,e),Object(p.a)(t,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach(function(e){n._events[e]=n._events[e]||[],n._events[e].push(t)}),this}},{key:"off",value:function(e,t){var n=this;if(void 0!=e)return e.split(" ").forEach(function(e){e in n._events!==!1&&(t?n._events[e].splice(n._events[e].indexOf(t),1):n._events[e]=[])}),this;this._events={}}},{key:"emit",value:function(e){if(void 0!==this._events[e])for(var t=this._events[e].slice(),n=0;n<t.length;++n){var i=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==i)return i}}},{key:"guid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxxxx",t=(new Date).getTime(),n=e.replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return n}}]),t}(e)};var g=w,x=window.Autodesk,b=window.THREE;!function(){var e=function e(t){Object(d.a)(this,e),b.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=b.FrontSide,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(b.MeshBasicMaterial.prototype);var t=function e(t){Object(d.a)(this,e),b.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=3,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(b.LineBasicMaterial.prototype),void 0===b.PolyhedronGeometry&&(b.PolyhedronGeometry=function(e,t,n,i){b.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},n=n||1,i=i||0;for(var o=this,r=0,a=e.length;r<a;r+=3)x(new b.Vector3(e[r],e[r+1],e[r+2]));var s=this.vertices,l=[],c=(r=0,0);for(a=t.length;r<a;r+=3,c++){var h=s[t[r]],u=s[t[r+1]],d=s[t[r+2]];l[c]=new b.Face3(h.index,u.index,d.index,[h.clone(),u.clone(),d.clone()])}var p=new b.Vector3;for(r=0,a=l.length;r<a;r++)k(l[r],i);for(r=0,a=this.faceVertexUvs[0].length;r<a;r++){var m=this.faceVertexUvs[0][r],v=m[0].x,f=m[1].x,y=m[2].x,w=Math.max(v,Math.max(f,y)),g=Math.min(v,Math.min(f,y));w>.9&&g<.1&&(v<.2&&(m[0].x+=1),f<.2&&(m[1].x+=1),y<.2&&(m[2].x+=1))}for(r=0,a=this.vertices.length;r<a;r++)this.vertices[r].multiplyScalar(n);function x(e){var t=e.normalize().clone();t.index=o.vertices.push(t)-1;var n=T(e)/2/Math.PI+.5,i=function(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}(e)/Math.PI+.5;return t.uv=new b.Vector2(n,1-i),t}function M(e,t,n){var i=new b.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);o.faces.push(i),p.copy(e).add(t).add(n).divideScalar(3);var r=T(p);o.faceVertexUvs[0].push([z(e.uv,e,r),z(t.uv,t,r),z(n.uv,n,r)])}function k(e,t){for(var n=Math.pow(2,t),i=(Math.pow(4,t),x(o.vertices[e.a])),r=x(o.vertices[e.b]),a=x(o.vertices[e.c]),s=[],l=0;l<=n;l++){s[l]=[];for(var c=x(i.clone().lerp(a,l/n)),h=x(r.clone().lerp(a,l/n)),u=n-l,d=0;d<=u;d++)s[l][d]=0==d&&l==n?c:x(c.clone().lerp(h,d/u))}for(l=0;l<n;l++)for(d=0;d<2*(n-l)-1;d++){var p=Math.floor(d/2);d%2==0?M(s[l][p+1],s[l+1][p],s[l][p]):M(s[l][p+1],s[l+1][p+1],s[l+1][p])}}function T(e){return Math.atan2(e.z,-e.x)}function z(e,t,n){return n<0&&1===e.x&&(e=new b.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new b.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new b.Sphere(new b.Vector3,n)},b.PolyhedronGeometry.prototype=Object.create(b.Geometry.prototype)),void 0===b.OctahedronGeometry&&(b.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};b.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}},b.OctahedronGeometry.prototype=Object.create(b.Geometry.prototype)),void 0===b.TorusGeometry&&(b.TorusGeometry=function(e,t,n,i,o){b.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:o},e=e||100,t=t||40,n=n||8,i=i||6,o=o||2*Math.PI;for(var r=new b.Vector3,a=[],s=[],l=0;l<=n;l++)for(var c=0;c<=i;c++){var h=c/i*o,u=l/n*Math.PI*2;r.x=e*Math.cos(h),r.y=e*Math.sin(h);var d=new b.Vector3;d.x=(e+t*Math.cos(u))*Math.cos(h),d.y=(e+t*Math.cos(u))*Math.sin(h),d.z=t*Math.sin(u),this.vertices.push(d),a.push(new b.Vector2(c/i,l/n)),s.push(d.clone().sub(r).normalize())}for(l=1;l<=n;l++)for(c=1;c<=i;c++){var p=(i+1)*l+c-1,m=(i+1)*(l-1)+c-1,v=(i+1)*(l-1)+c,f=(i+1)*l+c,y=new b.Face3(p,m,f,[s[p].clone(),s[m].clone(),s[f].clone()]);this.faces.push(y),this.faceVertexUvs[0].push([a[p].clone(),a[m].clone(),a[f].clone()]),y=new b.Face3(m,v,f,[s[m].clone(),s[v].clone(),s[f].clone()]),this.faces.push(y),this.faceVertexUvs[0].push([a[m].clone(),a[v].clone(),a[f].clone()])}this.computeFaceNormals()},b.TorusGeometry.prototype=Object.create(b.Geometry.prototype));var n=function(e,t,n){var i=new b.Geometry;n=n||1;for(var o=0;o<=64*n;++o)"x"==t&&i.vertices.push(new b.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(e)),"y"==t&&i.vertices.push(new b.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(e)),"z"==t&&i.vertices.push(new b.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(e));return i},i=function(e,t,n,i,o,r){var a=new b.Geometry,s=new b.Mesh(new b.CylinderGeometry(e,t,n,i,o,r));return s.position.y=.5,s.updateMatrix(),a.merge(s.geometry,s.matrix),a},o=function(e){var t=new b.Geometry;return"X"===e?t.vertices.push(new b.Vector3(0,0,0),new b.Vector3(1,0,0)):"Y"===e?t.vertices.push(new b.Vector3(0,0,0),new b.Vector3(0,1,0)):"Z"===e&&t.vertices.push(new b.Vector3(0,0,0),new b.Vector3(0,0,1)),t};b.TransformGizmo=function(){var e=this;this.init=function(){b.Object3D.call(this),this.handles=new b.Object3D,this.pickers=new b.Object3D,this.planes=new b.Object3D,this.highlights=new b.Object3D,this.hemiPicker=new b.Object3D,this.subPickers=new b.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var e=new b.PlaneBufferGeometry(50,50,2,2),t=new b.MeshBasicMaterial({wireframe:!0});t.side=b.DoubleSide;var n={XY:new b.Mesh(e,t),YZ:new b.Mesh(e,t),XZ:new b.Mesh(e,t),XYZE:new b.Mesh(e,t)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,this.planes.add(n[i]),this.planes[i]=n[i],n[i].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(e){if(e instanceof b.Mesh){e.updateMatrix();var t=new b.Geometry;e.geometry instanceof b.BufferGeometry&&(e.geometry=(new b.Geometry).fromBufferGeometry(e.geometry)),t.merge(e.geometry,e.matrix),e.geometry=t,e.position.set(0,0,0),e.rotation.set(0,0,0),e.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(e){e.visible=!1})},this.show=function(){this.traverse(function(t){t.visible=!0,t.parent!=e.pickers&&t.parent!=e.hemiPicker||(t.visible=!1),t.parent==e.planes&&(t.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(t){t.material&&t.material.highlight&&(t.name==e?t.material.highlight(!0):t.material.highlight(!1))})},this.setupGizmos=function(){var e=function(e,t){for(var n in e)for(var i=e[n].length;i--;){var o=e[n][i][0],r=e[n][i][1],a=e[n][i][2],s=e[n][i][3];o.name=n,r&&o.position.set(r[0],r[1],r[2]),a&&o.rotation.set(a[0],a[1],a[2]),s&&(o.visble=s),t.add(o)}};this.setHandlePickerGizmos(),e(this.handleGizmos,this.handles),e(this.pickerGizmos,this.pickers),e(this.highlightGizmos,this.highlights),e(this.hemiPickerGizmos,this.hemiPicker),e(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},b.TransformGizmo.prototype=Object.create(b.Object3D.prototype),b.TransformGizmo.prototype.update=function(e,t){var n=new b.Vector3(0,0,0),i=new b.Vector3(0,1,0),o=new b.Matrix4;this.traverse(function(r){r.name&&(-1!=r.name.search("E")?r.quaternion.setFromRotationMatrix(o.lookAt(t,n,i)):-1==r.name.search("X")&&-1==r.name.search("Y")&&-1==r.name.search("Z")||r.quaternion.setFromEuler(e))})},b.TransformGizmoTranslate=function(){b.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=i(0,.05,.2,12,1,!1),r=o("X"),a=o("Y"),s=o("Z");this.handleGizmos={X:[[new b.Mesh(n,new e({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new b.Line(r,new t({color:15805484}))]],Y:[[new b.Mesh(n,new e({color:768011})),[0,.5,0]],[new b.Line(a,new t({color:768011}))]],Z:[[new b.Mesh(n,new e({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new b.Line(s,new t({color:2895089}))]],XYZ:[[new b.Mesh(new b.OctahedronGeometry(.1,0),new e({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new b.Mesh(new b.PlaneBufferGeometry(.29,.29),new e({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new b.Mesh(new b.PlaneBufferGeometry(.29,.29),new e({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Mesh(new b.PlaneBufferGeometry(.29,.29),new e({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new b.Mesh(new b.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new b.Mesh(new b.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new b.Mesh(new b.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new b.Mesh(new b.OctahedronGeometry(.2,0),new e({color:16777215,opacity:.25}))]],XY:[[new b.Mesh(new b.PlaneBufferGeometry(.4,.4),new e({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new b.Mesh(new b.PlaneBufferGeometry(.4,.4),new e({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new b.Mesh(new b.PlaneBufferGeometry(.4,.4),new e({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new b.Mesh(new b.BoxGeometry(1.2,1.2,1.2),new e({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(e,t){var n=new b.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),"XY"==e&&(this.activePlane=this.planes.XY),"YZ"==e&&(this.activePlane=this.planes.YZ),"XZ"==e&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},b.TransformGizmoTranslate.prototype=Object.create(b.TransformGizmo.prototype),b.TransformGizmoRotate=function(){b.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new b.Line(n(1,"x",.5),new t({color:16711680}))]],RY:[[new b.Line(n(1,"y",.5),new t({color:65280}))]],RZ:[[new b.Line(n(1,"z",.5),new t({color:255}))]],RE:[[new b.Line(n(1.25,"z",1),new t({color:65535}))]],RXYZE:[[new b.Line(n(1,"z",1),new t({color:16711935}))]]},this.pickerGizmos={RX:[[new b.Mesh(new b.TorusGeometry(1,.12,4,12,Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new b.Mesh(new b.TorusGeometry(1,.12,4,12,Math.PI),new e({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new b.Mesh(new b.TorusGeometry(1,.12,4,12,Math.PI),new e({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new b.Mesh(new b.TorusGeometry(1.25,.12,2,24),new e({color:65535,opacity:.25}))]],RXYZE:[[new b.Mesh(new b.TorusGeometry(1,.12,2,24),new e({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(e){"RE"==e&&(this.activePlane=this.planes.XYZE),"RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(e,t){b.TransformGizmo.prototype.update.apply(this,arguments);var n=new b.Matrix4,i=new b.Euler(0,0,1),o=new b.Quaternion,r=new b.Vector3(1,0,0),a=new b.Vector3(0,1,0),s=new b.Vector3(0,0,1),l=new b.Quaternion,c=new b.Quaternion,h=new b.Quaternion,u=t.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),u.applyMatrix4(n),this.traverse(function(e){o.setFromEuler(i),"RX"==e.name&&(l.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(a,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),e.quaternion.copy(o))})},this.init()},b.TransformGizmoRotate.prototype=Object.create(b.TransformGizmo.prototype),b.TransformGizmoTranslateRotate=function(){b.TransformGizmo.call(this);var t=this;this.setHandlePickerGizmos=function(){var t=i(0,.05,.2,12,1,!1);(new b.Geometry).vertices.push(new b.Vector3(0,0,-.1),new b.Vector3(0,0,.1),new b.Vector3(-.1,0,0),new b.Vector3(.1,0,0));this.handleGizmos={Z:[[new b.Mesh(t,new e({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new b.Mesh(new b.CylinderGeometry(.015,.015,.6,4,1,!1),new e({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new b.Mesh(new b.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new b.Mesh(new b.CylinderGeometry(.05,.05,.015,60,1,!1),new e({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new b.Mesh(new b.TorusGeometry(1,.015,12,60,.3*Math.PI),new e({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new b.Mesh(new b.CylinderGeometry(.05,.05,.01,60,1,!1),new e({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new b.Mesh(new b.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new b.Mesh(new b.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new b.Mesh(new b.TorusGeometry(1,.12,4,12,.3*Math.PI),new e({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new b.Mesh(new b.CylinderGeometry(.12,.12,.65,4,1,!1),new e({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new b.Mesh(new b.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new b.Mesh(new b.TorusGeometry(1,.02,12,60,2*Math.PI),new e({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new b.Mesh(new b.SphereGeometry(1.2,8,8,0,Math.PI),new e({color:255})),null,null,!1]]}},this.setActivePlane=function(e,t){if("translate"==this.activeMode){var n=new b.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==e&&(this.activePlane=this.planes.YZ),"RY"==e&&(this.activePlane=this.planes.XZ),"RZ"==e&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(e,t){if("translate"==this.activeMode)b.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){b.TransformGizmo.prototype.update.apply(this,arguments);var n=new b.Matrix4,i=new b.Euler(0,0,1),o=new b.Quaternion,r=new b.Vector3(1,0,0),a=new b.Vector3(0,1,0),s=new b.Vector3(0,0,1),l=new b.Quaternion,c=new b.Quaternion,h=new b.Quaternion,u=t.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),u.applyMatrix4(n),this.traverse(function(e){o.setFromEuler(i),"RX"==e.name&&(l.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,l),e.quaternion.copy(o)),"RY"==e.name&&(c.setFromAxisAngle(a,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,c),e.quaternion.copy(o)),"RZ"==e.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),e.quaternion.copy(o))})}},this.show=function(){this.traverse(function(e){(null==t.parent||t.parent.useAllPickers||e.parent!=t.handles)&&(e.visible=!0),e.material&&(e.material.opacity=e.material.oldOpacity),e.parent!=t.pickers&&e.parent!=t.hemiPicker&&e.parent!=t.subPickers||(e.visible=!1),e.parent!=t.planes&&e.parent!=t.highlights||(e.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(e){this.traverse(function(n){n.material&&n.material.highlight&&(n.name==e?(n.parent!=t.highlights&&n.parent!=t.handles||(n.visible=!0),n.material.highlight(!0)):(n.material.highlight(!1),n.material.opacity=.1))})},this.init()},b.TransformGizmoTranslateRotate.prototype=Object.create(b.TransformGizmo.prototype),b.TransformGizmoScale=function(){b.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=i(.125,.125,.125),r=o("X"),a=o("Y"),s=o("Z");this.handleGizmos={X:[[new b.Mesh(n,new e({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new b.Line(r,new t({color:16711680}))]],Y:[[new b.Mesh(n,new e({color:65280})),[0,.5,0]],[new b.Line(a,new t({color:65280}))]],Z:[[new b.Mesh(n,new e({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new b.Line(s,new t({color:255}))]],XYZ:[[new b.Mesh(new b.BoxGeometry(.125,.125,.125),new e({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new b.Mesh(new b.CylinderGeometry(.2,0,1,4,1,!1),new e({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new b.Mesh(new b.CylinderGeometry(.2,0,1,4,1,!1),new e({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new b.Mesh(new b.CylinderGeometry(.2,0,1,4,1,!1),new e({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new b.Mesh(new b.BoxGeometry(.4,.4,.4),new e({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(e,t){var n=new b.Matrix4;t.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==e&&(this.activePlane=this.planes.XY,Math.abs(t.y)>Math.abs(t.z)&&(this.activePlane=this.planes.XZ)),"Y"==e&&(this.activePlane=this.planes.XY,Math.abs(t.x)>Math.abs(t.z)&&(this.activePlane=this.planes.YZ)),"Z"==e&&(this.activePlane=this.planes.XZ,Math.abs(t.x)>Math.abs(t.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==e&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},b.TransformGizmoScale.prototype=Object.create(b.TransformGizmo.prototype),b.TransformControls=function(e,t,n){switch(b.Object3D.call(this),t=void 0!==t?t:document,this.gizmo={},n){case"translate":this.gizmo[n]=new b.TransformGizmoTranslate;break;case"rotate":this.gizmo[n]=new b.TransformGizmoRotate;break;case"transrotate":this.gizmo[n]=new b.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[n]=new b.TransformGizmoScale}if(this.add(this.gizmo[n]),this.gizmo[n].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new b.Vector3(1,0,0),this.unitY=new b.Vector3(0,1,0),this.unitZ=new b.Vector3(0,0,1),this.normal=new b.Vector3(0,0,1),"transrotate"===n){(o=new b.Geometry).vertices.push(new b.Vector3(0,0,0),new b.Vector3(0,0,1));var i=new b.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new b.Line(o,i);var o=new b.Geometry;i=new b.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});o.vertices.push(new b.Vector3(0,0,0),new b.Vector3(0,0,1)),this.endLine=new b.Line(o,i);o=new b.Geometry,i=new b.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});o.vertices.push(new b.Vector3(0,-1,0),new b.Vector3(0,1,0)),this.centerLine=new b.Line(o,i),(r=b.ImageUtils.loadTexture(x.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=r.minFilter=b.NearestFilter;var r;o=new b.CircleGeometry(.1,32),i=new b.MeshBasicMaterial({opacity:1,side:b.DoubleSide,transparent:!0,map:r});this.centerMark=new b.Mesh(o,i),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(r=b.ImageUtils.loadTexture(x.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=r.minFilter=b.NearestFilter;i=new b.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:b.DoubleSide,map:r});var a=.25;this.ticks.RX=new b.Object3D;o=new b.PlaneBufferGeometry(.12,a);var s=new b.Mesh(o,i);s.position.set(0,0,-1.275),s.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(s),(s=s.clone()).position.set(0,-1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),this.ticks.RY=new b.Object3D,(s=s.clone()).position.set(0,0,-1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(-1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s)}var l=this,c=!1,h=n,u={type:"change"},d={type:"mouseDown"},p={type:"mouseUp",mode:h},m={type:"objectChange"},v=new b.Raycaster,f=new b.Vector3,y=new b.Vector3,w=new b.Vector3,g=new b.Vector3,M=new b.Vector3,k=new b.Vector3,T=1,z=new b.Matrix4,I=new b.Vector3,P=new b.Matrix4,E=new b.Vector3,_=new b.Quaternion,O=new b.Vector3,V=new b.Vector3,C=new b.Vector3,j=new b.Quaternion,G=new b.Quaternion,A=new b.Quaternion,S=new b.Quaternion,L=new b.Quaternion,R=new b.Vector3,F=new b.Vector3,D=new b.Matrix4,Y=new b.Matrix4,N=new b.Vector3,X=new b.Vector3,Z=new b.Euler,B=new b.Matrix4,W=new b.Vector3;new b.Euler;function Q(n,i){var o=t.getBoundingClientRect(),r=(n.clientX-o.left)/o.width*2-1,a=-(n.clientY-o.top)/o.height*2+1;e.isPerspective?(f.set(r,a,.5),f.unproject(e),v.set(e.position,f.sub(e.position).normalize())):(f.set(r,a,-1),f.unproject(e),y.set(0,0,-1),v.set(f,y.transformDirection(e.matrixWorld)));var s=v.intersectObjects(i,!0);return!!s[0]&&s[0]}this.attach=function(e){l.object=e,this.gizmo[h].show(),l.update(),l.updateUnitVectors()},this.detach=function(e){l.object=void 0,this.axis=null,this.gizmo[h].hide()},this.setMode=function(e){"scale"==(h=e||h)&&(l.space="local"),this.gizmo[h].show(),this.update(),l.dispatchEvent(u)},this.getPicker=function(){return l.gizmo[h].hemiPicker.children},this.setPosition=function(e){this.object.position.copy(e),this.update()},this.setNormal=function(e){_.setFromUnitVectors(this.normal,e),this.unitX.applyQuaternion(_),this.unitY.applyQuaternion(_),this.unitZ.applyQuaternion(_),this.normal.copy(e),this.object&&this.object.quaternion.multiply(_),this.update()},this.setSnap=function(e,t){l.snap=e,l.snapDelta=t},this.setSize=function(e){l.size=e,this.update(),l.dispatchEvent(u)},this.setSpace=function(e){l.space=e,this.update(),l.dispatchEvent(u)},this.update=function(n){if(void 0!==l.object){l.object.updateMatrixWorld(),X.setFromMatrixPosition(l.object.matrixWorld),Z.setFromRotationMatrix(P.extractRotation(l.object.matrixWorld)),e.updateMatrixWorld(),W.setFromMatrixPosition(e.matrixWorld),this.position.copy(X),this.quaternion.setFromEuler(Z),this.normal.set(0,0,1),this.normal.applyEuler(Z);var i=X.distanceTo(W),o=e.isPerspective?2*Math.tan(e.fov*Math.PI/360)*i:i,r=t.getBoundingClientRect();T=100*o/r.height,this.scale.set(T,T,T),n&&this.gizmo[h].highlight(l.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(Z),this.unitY.applyEuler(Z),this.unitZ.applyEuler(Z)},this.showRotationGizmos=function(e){for(var t=this.gizmo[h].handles.children,n=0;n<t.length;n++){var i=t[n];i.visible=!0,-1!==i.name.search("R")&&(i.visible=e)}this.useAllPickers=e},this.highlight=function(){this.gizmo[h].highlight(this.axis||"Z")},this.onPointerHover=function(e){if(void 0===l.object||!0===c)return!1;var t=Q(e.pointers?e.pointers[0]:e,l.useAllPickers?l.gizmo[h].pickers.children:l.gizmo[h].subPickers.children),n=null,i="";return t&&(i=-1!=(n=t.object.name).search("R")?"rotate":"translate"),l.axis!==n&&(l.axis=n,l.gizmo[h].activeMode=i,l.update(!0),l.dispatchEvent(u)),null===l.axis&&l.gizmo[h].show(),!!t},this.onPointerDown=function(t){if(void 0===l.object||!0===c)return!1;var n=t.pointers?t.pointers[0]:t;if("touch"===t.pointerType){var i=null,o="";(r=Q(n,l.useAllPickers?l.gizmo[h].pickers.children:l.gizmo[h].subPickers.children))&&(o=-1!=(i=r.object.name).search("R")?"rotate":"translate"),l.axis!==i&&(l.axis=i,l.gizmo[h].activeMode=o)}var r=null;if((0===n.button||void 0===n.button)&&(r=Q(n,l.useAllPickers?l.gizmo[h].pickers.children:l.gizmo[h].subPickers.children))){l.dispatchEvent(d),l.axis=r.object.name,l.update(),I.copy(e.position).sub(X).normalize(),l.gizmo[h].setActivePlane(l.axis,I);var a=Q(n,[l.gizmo[h].activePlane]);if(a&&g.copy(a.point),R.copy(l.object.position),F.copy(l.object.scale),D.extractRotation(l.object.matrix),B.extractRotation(l.object.matrixWorld),l.object.parent?(Y.extractRotation(l.object.parent.matrixWorld),N.setFromMatrixScale(P.getInverse(l.object.parent.matrixWorld))):(Y.extractRotation(l.object.matrixWorld),N.setFromMatrixScale(P.getInverse(l.object.matrixWorld))),"transrotate"===h&&"rotate"===l.gizmo[h].activeMode){l.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(l.matrixWorld),l.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(l.matrixWorld),l.startLine.geometry.verticesNeedUpdate=!0,l.parent.add(l.startLine);var s=l.object.geometry.getAttribute("position"),u=(new b.Vector3).fromAttribute(s,0).applyMatrix4(l.object.matrixWorld),p=(new b.Vector3).fromAttribute(s,1).applyMatrix4(l.object.matrixWorld),m=(new b.Vector3).fromAttribute(s,2).applyMatrix4(l.object.matrixWorld),v=(new b.Vector3).fromAttribute(s,3).applyMatrix4(l.object.matrixWorld);if("RX"===l.axis){u.lerp(m,.5),p.lerp(v,.5);var f=u.distanceTo(p);l.centerLine.material.dashSize=f/15,l.centerLine.material.gapSize=f/30,l.centerLine.geometry.vertices[0].copy(u),l.centerLine.geometry.vertices[1].copy(p)}else{u.lerp(p,.5),m.lerp(v,.5);f=u.distanceTo(m);l.centerLine.material.dashSize=f/15,l.centerLine.material.gapSize=f/30,l.centerLine.geometry.vertices[0].copy(u),l.centerLine.geometry.vertices[1].copy(m)}l.centerLine.geometry.computeLineDistances(),l.centerLine.geometry.verticesNeedUpdate=!0,l.parent.add(l.centerLine),l.ticks[l.axis].position.copy(l.position),l.ticks[l.axis].quaternion.copy(l.quaternion),l.ticks[l.axis].scale.copy(l.scale),l.parent.add(l.ticks[l.axis])}}return c=!0,!!r},this.onPointerMove=function(e){if(void 0===l.object||null===l.axis||!1===c)return!1;var t=Q(e.pointers?e.pointers[0]:e,[l.gizmo[h].activePlane]);t&&w.copy(t.point);var n=l.gizmo[h].activeMode;if("translate"==n)w.sub(g),w.multiply(N),"local"==l.space&&(w.applyMatrix4(P.getInverse(B)),O.copy(this.unitX),V.copy(this.unitY),C.copy(this.unitZ),E.set(0,0,0),-1!=l.axis.search("X")&&(O.multiplyScalar(w.dot(this.unitX)),E.add(O)),-1!=l.axis.search("Y")&&(V.multiplyScalar(w.dot(this.unitY)),E.add(V)),-1!=l.axis.search("Z")&&(C.multiplyScalar(w.dot(this.unitZ)),E.add(C)),w.copy(E),w.applyMatrix4(D),l.object.position.copy(R),l.object.position.add(w)),"world"!=l.space&&-1==l.axis.search("XYZ")||(O.copy(this.unitX),V.copy(this.unitY),C.copy(this.unitZ),E.set(0,0,0),-1!=l.axis.search("X")&&(O.multiplyScalar(w.dot(this.unitX)),E.add(O)),-1!=l.axis.search("Y")&&(V.multiplyScalar(w.dot(this.unitY)),E.add(V)),-1!=l.axis.search("Z")&&(C.multiplyScalar(w.dot(this.unitZ)),E.add(C)),w.copy(E),w.applyMatrix4(P.getInverse(Y)),l.object.position.copy(R),l.object.position.add(w));else if("scale"==n)w.sub(g),w.multiply(N),"local"==l.space&&("XYZ"==l.axis?(T=1+w.y/50,l.object.scale.x=F.x*T,l.object.scale.y=F.y*T,l.object.scale.z=F.z*T):(w.applyMatrix4(P.getInverse(B)),"X"==l.axis&&(l.object.scale.x=F.x*(1+w.x/50)),"Y"==l.axis&&(l.object.scale.y=F.y*(1+w.y/50)),"Z"==l.axis&&(l.object.scale.z=F.z*(1+w.z/50))));else if("rotate"==n){if(w.sub(X),w.multiply(N),E.copy(g).sub(X),E.multiply(N),"RE"==l.axis){w.applyMatrix4(P.getInverse(z)),E.applyMatrix4(P.getInverse(z)),M.set(Math.atan2(w.z,w.y),Math.atan2(w.x,w.z),Math.atan2(w.y,w.x)),k.set(Math.atan2(E.z,E.y),Math.atan2(E.x,E.z),Math.atan2(E.y,E.x)),_.setFromRotationMatrix(P.getInverse(Y));var i=M.z-k.z;if(null!==l.snap){var o=Math.round(i/l.snap)*l.snap;Math.abs(o-i)<l.snapDelta&&(i=o)}L.setFromAxisAngle(I,i),j.setFromRotationMatrix(B),_.multiplyQuaternions(_,L),_.multiplyQuaternions(_,j),l.object.quaternion.copy(_)}else if("RXYZE"==l.axis){var r=w.clone().cross(E).normalize();_.setFromRotationMatrix(P.getInverse(Y));var a=-w.clone().angleTo(E);if(null!==l.snap){o=Math.round(a/l.snap)*l.snap;Math.abs(o-a)<l.snapDelta&&(a=o)}G.setFromAxisAngle(r,a),j.setFromRotationMatrix(B),_.multiplyQuaternions(_,G),_.multiplyQuaternions(_,j),l.object.quaternion.copy(_)}else if("local"==l.space){w.applyMatrix4(P.getInverse(B)),E.applyMatrix4(P.getInverse(B));var s=w.dot(this.unitX),d=w.dot(this.unitY),p=w.dot(this.unitZ),v=E.dot(this.unitX),f=E.dot(this.unitY),y=E.dot(this.unitZ);M.set(Math.atan2(p,d),Math.atan2(s,p),Math.atan2(d,s)),k.set(Math.atan2(y,f),Math.atan2(v,y),Math.atan2(f,v));var x=M.x-k.x,b=M.y-k.y;i=M.z-k.z;if(null!==l.snap){if(-1!=l.axis.search("X")){o=Math.round(x/l.snap)*l.snap;Math.abs(o-x)<l.snapDelta&&(x=o)}if(-1!=l.axis.search("Y")){o=Math.round(b/l.snap)*l.snap;Math.abs(o-b)<l.snapDelta&&(b=o)}if(-1!=l.axis.search("Z")){o=Math.round(i/l.snap)*l.snap;Math.abs(o-i)<l.snapDelta&&(i=o)}}G.setFromAxisAngle(this.unitX,x),A.setFromAxisAngle(this.unitY,b),S.setFromAxisAngle(this.unitZ,i),j.setFromRotationMatrix(D),"RX"==l.axis&&j.multiplyQuaternions(j,G),"RY"==l.axis&&j.multiplyQuaternions(j,A),"RZ"==l.axis&&j.multiplyQuaternions(j,S),l.object.quaternion.copy(j)}else if("world"==l.space){s=w.dot(this.unitX),d=w.dot(this.unitY),p=w.dot(this.unitZ),v=E.dot(this.unitX),f=E.dot(this.unitY),y=E.dot(this.unitZ);M.set(Math.atan2(p,d),Math.atan2(s,p),Math.atan2(d,s)),k.set(Math.atan2(y,f),Math.atan2(v,y),Math.atan2(f,v)),_.setFromRotationMatrix(P.getInverse(Y));x=M.x-k.x,b=M.y-k.y,i=M.z-k.z;if(null!==l.snap){if(-1!=l.axis.search("X")){o=Math.round(x/l.snap)*l.snap;Math.abs(o-x)<l.snapDelta&&(x=o)}if(-1!=l.axis.search("Y")){o=Math.round(b/l.snap)*l.snap;Math.abs(o-b)<l.snapDelta&&(b=o)}if(-1!=l.axis.search("Z")){o=Math.round(i/l.snap)*l.snap;Math.abs(o-i)<l.snapDelta&&(i=o)}}G.setFromAxisAngle(this.unitX,x),A.setFromAxisAngle(this.unitY,b),S.setFromAxisAngle(this.unitZ,i),j.setFromRotationMatrix(B),"RX"==l.axis&&_.multiplyQuaternions(_,G),"RY"==l.axis&&_.multiplyQuaternions(_,A),"RZ"==l.axis&&_.multiplyQuaternions(_,S),_.multiplyQuaternions(_,j),l.object.quaternion.copy(_)}"transrotate"===h&&(l.add(l.endLine),l.add(l.centerMark))}return l.object.matrixAutoUpdate=!0,l.update(!0),l.dispatchEvent(u),l.dispatchEvent(m),!!t},this.onPointerUp=function(e){return c&&null!==l.axis&&(p.mode=h,l.dispatchEvent(p)),c=!1,this.gizmo[h].show(),this.updateUnitVectors(),"transrotate"===h&&"rotate"===this.gizmo[h].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},b.TransformControls.prototype=Object.create(b.Object3D.prototype)}();var M=window.Autodesk,k=window.THREE,T=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this)))._dbIds=[],n.active=!1,n._viewer=e,n._isDragging=!1,n.fullTransform=!1,n._transformMesh=null,n._selectedFragProxyMap={},n._transformControlTx=null,n._hitPoint=new k.Vector3,n.onTxChange=n.onTxChange.bind(Object(y.a)(Object(y.a)(n))),n.onAggregateSelectionChanged=n.onAggregateSelectionChanged.bind(Object(y.a)(Object(y.a)(n))),n.onCameraChanged=n.onCameraChanged.bind(Object(y.a)(Object(y.a)(n))),n._selectionMode="SELECTION_MODE_TRANSFORM",n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"getNames",value:function(){return["Viewing.Transform.Tool"]}},{key:"getName",value:function(){return"Viewing.Transform.Tool"}},{key:"createTransformMesh",value:function(){var e=new k.MeshPhongMaterial({color:16711680});this._viewer.impl.matman().addMaterial("transform-tool-material",e,!0);var t=new k.Mesh(new k.SphereGeometry(1e-4,5),e);return t.position.set(0,0,0),t}},{key:"onTxChange",value:function(){if(this._isDragging&&this._transformControlTx.visible){var e=new k.Vector3(this._transformMesh.position.x-this._selection.model.offset.x,this._transformMesh.position.y-this._selection.model.offset.y,this._transformMesh.position.z-this._selection.model.offset.z);for(var t in this._selectedFragProxyMap){var n=this._selectedFragProxyMap[t],i=new k.Vector3(this._transformMesh.position.x-n.offset.x,this._transformMesh.position.y-n.offset.y,this._transformMesh.position.z-n.offset.z);n.position=i,n.updateAnimTransform()}this.emit("transform.translate",{model:this._selection.model,translation:e})}this._viewer.impl.sceneUpdated(!0)}},{key:"onCameraChanged",value:function(){this._transformControlTx&&this._transformControlTx.update()}},{key:"onAggregateSelectionChanged",value:function(e){var t=this;switch(this._selectionMode){case"SELECTION_MODE_TRANSFORM":if(e.selections&&e.selections.length){var n=e.selections[0];this.setSelection(n)}else this.clearSelection();break;case"SELECTION_MODE_PICK":e.selections&&e.selections.length&&(this._selectionMode="SELECTION_MODE_RESUME_TRANSFORM",this.emit("transform.modelSelected",this._selection),this._viewer.clearSelection(),this._viewer.select(this._dbIds),this.setPosition(this._hitPoint));case"SELECTION_MODE_RESUME_TRANSFORM":setTimeout(function(){t._selectionMode="SELECTION_MODE_TRANSFORM"},300)}}},{key:"setSelection",value:function(e){if(this._selection=e,this._dbIds=this._selection.dbIdArray,this.fullTransform){this._selection.fragIdsArray=[];for(var t=this._selection.model.getFragmentList().fragments.fragId2dbId.length,n=0;n<t;++n)this._selection.fragIdsArray.push(n);this._selection.dbIdArray=[];var i=this._selection.model.getData().instanceTree.getRootId();this._selection.dbIdArray.push(i)}this.emit("transform.modelSelected",this._selection),this.initializeSelection(this._hitPoint)}},{key:"initializeSelection",value:function(e){var t=this;this._selectedFragProxyMap={};var n=this._selection.model.transform||{translation:{x:0,y:0,z:0}};this._selection.model.offset={x:e.x-n.translation.x,y:e.y-n.translation.y,z:e.z-n.translation.z},this._transformControlTx.visible=!0,this._transformControlTx.setPosition(e),this._transformControlTx.addEventListener("change",this.onTxChange),this._viewer.addEventListener(M.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this._selection.fragIdsArray.forEach(function(n){var i=t._viewer.impl.getFragmentProxy(t._selection.model,n);i.getAnimTransform(),i.offset={x:e.x-i.position.x,y:e.y-i.position.y,z:e.z-i.position.z},t._selectedFragProxyMap[n]=i})}},{key:"clearSelection",value:function(){this.active&&(this._selection=null,this._selectedFragProxyMap={},this._transformControlTx.visible=!1,this._transformControlTx.removeEventListener("change",this.onTxChange),this._viewer.removeEventListener(M.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this._viewer.impl.sceneUpdated(!0),this.emit("transform.clearSelection",this._selection))}},{key:"setPosition",value:function(e){for(var t in this._transformControlTx.setPosition(e),this._selectedFragProxyMap){var n=this._selectedFragProxyMap[t],i=new k.Vector3(e.x-n.offset.x,e.y-n.offset.y,e.z-n.offset.z);n.position=i,n.updateAnimTransform()}this._viewer.impl.sceneUpdated(!0)}},{key:"normalize",value:function(e){var t=this._viewer.navigation.getScreenViewport();return{x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height}}},{key:"getHitPoint",value:function(e){var t={x:e.clientX,y:e.clientY},n=this.normalize(t);return this._viewer.utilities.getHitPoint(n.x,n.y)}},{key:"hitPoint",value:function(){return this._transformControlTx.position}},{key:"setHitPoint",value:function(e){this._hitPoint.x=e.x,this._hitPoint.y=e.y,this._hitPoint.z=e.z}},{key:"activate",value:function(){if(!this.active){this.active=!0;var e=this._viewer.model.getBoundingBox();this._viewer.impl.createOverlayScene("TransformToolOverlay"),this._transformControlTx=new k.TransformControls(this._viewer.impl.camera,this._viewer.impl.canvas,"translate"),this._transformControlTx.setSize(5*e.getBoundingSphere().radius),this._transformControlTx.visible=!1,this._viewer.impl.addOverlay("TransformToolOverlay",this._transformControlTx),this._transformMesh=this.createTransformMesh(),this._transformControlTx.attach(this._transformMesh),this._viewer.addEventListener(M.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged)}}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this._viewer.impl.removeOverlay("TransformToolOverlay",this._transformControlTx),this._transformControlTx.removeEventListener("change",this.onTxChange),this._viewer.impl.removeOverlayScene("TransformToolOverlay"),this._viewer.removeEventListener(M.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChanged),this._viewer.removeEventListener(M.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChanged))}},{key:"onPick",value:function(){this.active&&(this._selectionMode="SELECTION_MODE_PICK")}},{key:"handleButtonDown",value:function(e,t){if(this._isDragging=!0,this._transformControlTx.onPointerDown(e))return!0;var n=this.getHitPoint(e);return n&&(this._translation=new k.Vector3,this._hitPoint.copy(n)),!1}},{key:"handleButtonUp",value:function(e,t){return this._isDragging=!1,!!this._transformControlTx.onPointerUp(e)}},{key:"handleMouseMove",value:function(e){return this._isDragging?!!this._transformControlTx.onPointerMove(e):!!this._transformControlTx.onPointerHover(e)}},{key:"handleKeyDown",value:function(e,t){return 27===t&&this._viewer.clearSelection(),!1}}]),t}(g),z=(n(23),window.Autodesk),I=window.THREE,P=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this))).keys={},n.active=!1,n.viewer=e,n.fullTransform=!1,n._hitPoint=new I.Vector3,n.viewer.toolController.registerTool(Object(y.a)(Object(y.a)(n))),n.onAggregateSelectionChangedHandler=function(e){n.onAggregateSelectionChanged(e)},n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"enable",value:function(e){var t=this.getName();e?this.viewer.toolController.activateTool(t):this.viewer.toolController.deactivateTool(t)}},{key:"getNames",value:function(){return["Viewing.Rotate.Tool"]}},{key:"getName",value:function(){return"Viewing.Rotate.Tool"}},{key:"activate",value:function(){this.active||(this.active=!0,this.viewer.addEventListener(z.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChangedHandler))}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this.rotateControl&&(this.rotateControl.remove(),this.rotateControl=null),this.viewer.removeEventListener(z.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChangedHandler))}},{key:"onAggregateSelectionChanged",value:function(e){if(this.rotateControl&&this.rotateControl.engaged)this.rotateControl.engaged=!1;else if(e.selections&&e.selections.length){var t=e.selections[0];this.setSelection(t)}else this.clearSelection()}},{key:"setSelection",value:function(e){if(this.selection=e,this.emit("transform.modelSelected",this.selection),this.fullTransform){this.selection.fragIdsArray=[];for(var t=e.model.getFragmentList().fragments.fragId2dbId.length,n=0;n<t;++n)this.selection.fragIdsArray.push(n);this.selection.dbIdArray=[];var i=e.model.getData().instanceTree.getRootId();this.selection.dbIdArray.push(i),this.drawAxis()}else this.drawAxis()}},{key:"clearSelection",value:function(){this.selection=null,this.rotateControl&&(this.rotateControl.remove(),this.rotateControl=null,this.viewer.impl.sceneUpdated(!0))}},{key:"drawAxis",value:function(){var e=this,t=this.geWorldBoundingBox(this.selection.fragIdsArray,this.selection.model.getFragmentList());this.center=new I.Vector3((t.min.x+t.max.x)/2,(t.min.y+t.max.y)/2,(t.min.z+t.max.z)/2);var n=.8*Math.max(t.max.x-t.min.x,t.max.y-t.min.y,t.max.z-t.min.z);this.rotateControl&&this.rotateControl.remove(),this.rotateControl=new E(this.viewer,this.center,n),this.rotateControl.on("transform.rotate",function(t){e.rotateFragments(e.selection.model,e.selection.fragIdsArray,t.axis,t.angle,e.center),e.viewer.impl.sceneUpdated(!0)})}},{key:"getHitPoint",value:function(e){var t={x:e.clientX,y:e.clientY},n=this.normalize(t);return this.viewer.utilities.getHitPoint(n.x,n.y)}},{key:"hitPoint",value:function(){return this._hitPoint}},{key:"normalize",value:function(e){var t=this.viewer.navigation.getScreenViewport();return{x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height}}},{key:"setHitPoint",value:function(e){this._hitPoint.copy(e)}},{key:"handleButtonDown",value:function(e,t){if(this.rotateControl&&this.rotateControl.onPointerDown(e))return!0;if(0===t&&this.keys.Control)return this.isDragging=!0,this.mousePos={x:e.clientX,y:e.clientY},!0;var n=this.getHitPoint(e);return n&&(this._hitPoint=n),!1}},{key:"handleButtonUp",value:function(e,t){return this.rotateControl&&this.rotateControl.onPointerUp(e),0===t&&(this.isDragging=!1),!1}},{key:"handleMouseMove",value:function(e){if(this.rotateControl&&this.rotateControl.onPointerHover(e),this.isDragging){if(this.selection){var t={x:this.mousePos.x-e.clientX,y:e.clientY-this.mousePos.y};this.mousePos={x:e.clientX,y:e.clientY};var n=Math.sqrt(t.x*t.x+t.y*t.y),i=new I.Vector3,o=new I.Vector3,r=new I.Vector3,a=new I.Vector3,s=this.viewer.getCamera(),l=new I.Vector3,c=new I.Vector3;c.copy(s.position).sub(s.target),r.copy(c).normalize(),a.copy(s.up).normalize(),i.crossVectors(a,r).normalize(),a.setLength(t.y),i.setLength(t.x),o.copy(a.add(i)),l.crossVectors(o,c).normalize(),this.rotateFragments(this.selection.model,this.selection.fragIdsArray,l,n*Math.PI/180,this.center),this.viewer.impl.sceneUpdated(!0)}return!0}return!1}},{key:"handleKeyDown",value:function(e,t){return this.keys[e.key]=!0,27===t&&this.viewer.clearSelection(),!1}},{key:"handleKeyUp",value:function(e,t){return this.keys[e.key]=!1,!1}},{key:"rotateFragments",value:function(e,t,n,i,o){var r=this,a=new I.Quaternion;a.setFromAxisAngle(n,i),t.forEach(function(t,n){var i=r.viewer.impl.getFragmentProxy(e,t);i.getAnimTransform();var s=new I.Vector3(i.position.x-o.x,i.position.y-o.y,i.position.z-o.z);if(s.applyQuaternion(a),s.add(o),i.position=s,i.quaternion.multiplyQuaternions(a,i.quaternion),0===n){r._hitPoint&&(r._hitPoint.sub(o),r._hitPoint.applyQuaternion(a),r._hitPoint.add(o));var l=new I.Euler;l.setFromQuaternion(i.quaternion,0),r.emit("transform.rotate",{rotation:l,model:e})}i.updateAnimTransform()})}},{key:"geWorldBoundingBox",value:function(e,t){var n=new I.Box3,i=new I.Box3;return e.forEach(function(e){t.getWorldBounds(e,n),i.union(n)}),i}}]),t}(g),E=function(e){function t(e,n,i){var o;Object(d.a)(this,t),(o=Object(m.a)(this,Object(v.a)(t).call(this))).engaged=!1,o.overlayScene="rotateControlScene",o.domElement=e.impl.canvas,o.camera=e.impl.camera,o.viewer=e,o.center=n,o.size=i,o.gizmos=[],o.viewer.impl.createOverlayScene(o.overlayScene),o.createAxis(n,new I.Vector3(1,0,0),.85*i,16711680),o.createAxis(n,new I.Vector3(0,1,0),.85*i,65280),o.createAxis(n,new I.Vector3(0,0,1),.85*i,255),o.camera.worldup.y?(o.gizmos.push(o.createGizmo(n,new I.Euler(0,Math.PI/2,0),.0045*i,.4*i,16711680,Math.PI,new I.Vector3(1,0,0))),o.gizmos.push(o.createGizmo(n,new I.Euler(Math.PI/2,0,0),.0045*i,.4*i,65280,2*Math.PI,new I.Vector3(0,1,0))),o.gizmos.push(o.createGizmo(n,new I.Euler(0,0,0),.0045*i,.4*i,255,Math.PI,new I.Vector3(0,0,1)))):(o.gizmos.push(o.createGizmo(n,new I.Euler(Math.PI/2,Math.PI/2,0),.0045*i,.4*i,16711680,Math.PI,new I.Vector3(1,0,0))),o.gizmos.push(o.createGizmo(n,new I.Euler(Math.PI/2,0,0),.0045*i,.4*i,65280,Math.PI,new I.Vector3(0,1,0))),o.gizmos.push(o.createGizmo(n,new I.Euler(0,0,0),.0045*i,.4*i,255,2*Math.PI,new I.Vector3(0,0,1)))),o.picker=o.createSphere(.02*i);var r=new I.LineBasicMaterial({color:16776960,linewidth:1,depthTest:!1,depthWrite:!1,transparent:!0});return o.angleLine=o.createLine(o.center,o.center,r),e.impl.sceneUpdated(!0),o}return Object(f.a)(t,e),Object(p.a)(t,[{key:"createLine",value:function(e,t,n){var i=new I.Geometry;i.vertices.push(new I.Vector3(e.x,e.y,e.z)),i.vertices.push(new I.Vector3(t.x,t.y,t.z));var o=new I.Line(i,n);return this.viewer.impl.addOverlay(this.overlayScene,o),o}},{key:"createCone",value:function(e,t,n,i){t.normalize();var o={x:e.x+t.x*n,y:e.y+t.y*n,z:e.z+t.z*n},r=new I.Matrix4;r.lookAt(e,o,(new I.Object3D).up);var a=new I.Matrix4;a.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),r.multiply(a);var s=new I.CylinderGeometry(0,.2*n,n,128,1),l=new I.Mesh(s,i);return l.applyMatrix(r),l.position.x=e.x+t.x*n/2,l.position.y=e.y+t.y*n/2,l.position.z=e.z+t.z*n/2,this.viewer.impl.addOverlay(this.overlayScene,l),l}},{key:"createAxis",value:function(e,t,n,i){var o={x:e.x+t.x*n,y:e.y+t.y*n,z:e.z+t.z*n},r=new I.LineBasicMaterial({color:i,linewidth:2,depthTest:!1,depthWrite:!1,transparent:!0});this.createLine(e,o,r),this.createCone(o,t,.1*n,r)}},{key:"createGizmo",value:function(e,t,n,i,o,r,a){var s=new _({color:o}),l=new _({color:o}),c=new I.Mesh(new I.TorusGeometry(i,n,64,64,r),s),h=new I.Mesh(new I.TorusGeometry(i,n,64,64,2*Math.PI),l);h.material.highlight(!0);var u=new I.Matrix4,d=new I.Quaternion;d.setFromEuler(t);var p=new I.Vector3(1,1,1);u.compose(e,d,p),c.applyMatrix(u),h.applyMatrix(u);var m=this.createBox(100*this.size,100*this.size,.01);return m.applyMatrix(u),h.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,c),this.viewer.impl.addOverlay(this.overlayScene,h),c.subGizmo=h,c.plane=m,c.axis=a,c}},{key:"createBox",value:function(e,t,n){var i=new _({color:0}),o=new I.BoxGeometry(e,t,n),r=new I.Mesh(o,i);return r.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,r),r}},{key:"createSphere",value:function(e){var t=new _({color:16776960}),n=new I.SphereGeometry(e,32,32),i=new I.Mesh(n,t);return i.visible=!1,this.viewer.impl.addOverlay(this.overlayScene,i),i}},{key:"pointerToRaycaster",value:function(e){var t=new I.Vector3,n=new I.Vector3,i=new I.Raycaster,o=this.domElement.getBoundingClientRect(),r=(e.clientX-o.left)/o.width*2-1,a=-(e.clientY-o.top)/o.height*2+1;return this.camera.isPerspective?(t.set(r,a,.5),t.unproject(this.camera),i.set(this.camera.position,t.sub(this.camera.position).normalize())):(t.set(r,a,-1),t.unproject(this.camera),n.set(0,0,-1),i.set(t,n.transformDirection(this.camera.matrixWorld))),i}},{key:"onPointerDown",value:function(e){var t=e.pointers?e.pointers[0]:e;if(0===t.button){var n=this.pointerToRaycaster(t).intersectObjects(this.gizmos,!0);n.length?(this.gizmos.forEach(function(e){e.visible=!1}),this.selectedGizmo=n[0].object,this.selectedGizmo.subGizmo.visible=!0,this.picker.position.copy(n[0].point),this.angleLine.geometry.vertices[1].copy(n[0].point),this.lastDir=n[0].point.sub(this.center).normalize(),this.angleLine.geometry.verticesNeedUpdate=!0,this.angleLine.visible=!0,this.picker.visible=!0):this.picker.visible=!1,this.engaged=this.picker.visible,this.viewer.impl.sceneUpdated(!0)}return this.picker.visible}},{key:"onPointerHover",value:function(e){var t=e.pointers?e.pointers[0]:e;if(this.engaged){if((a=this.pointerToRaycaster(t).intersectObjects([this.selectedGizmo.plane],!0)).length){var n=a[0].point.sub(this.center).normalize(),i=new I.Vector3;i.crossVectors(this.lastDir,n);var o=Math.sign(i.dot(this.selectedGizmo.axis));this.emit("transform.rotate",{angle:o*n.angleTo(this.lastDir),axis:this.selectedGizmo.axis}),this.lastDir=n;var r=new I.Vector3(this.center.x+n.x*this.size*.8,this.center.y+n.y*this.size*.8,this.center.z+n.z*this.size*.8);this.picker.position.copy(r),this.angleLine.geometry.vertices[1].copy(r)}this.angleLine.visible=!0,this.angleLine.geometry.verticesNeedUpdate=!0}else{var a;this.angleLine.visible=!1,(a=this.pointerToRaycaster(t).intersectObjects(this.gizmos,!0)).length?(this.picker.position.set(a[0].point.x,a[0].point.y,a[0].point.z),this.picker.visible=!0):this.picker.visible=!1}this.viewer.impl.sceneUpdated(!0)}},{key:"onPointerUp",value:function(e){var t=this;this.angleLine.visible=!1,this.picker.visible=!1,this.gizmos.forEach(function(e){e.visible=!0,e.subGizmo.visible=!1}),this.viewer.impl.sceneUpdated(!0),setTimeout(function(){t.engaged=!1},100)}},{key:"normalize",value:function(e){var t=this.viewer.navigation.getScreenViewport();return{x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height}}},{key:"projectOntoPlane",value:function(e,t){var n=t.dot(e);return new I.Vector3(e.x-n*t.x,e.y-n*t.y,e.z-n*t.z)}},{key:"remove",value:function(){this.viewer.impl.removeOverlayScene(this.overlayScene)}}]),t}(g),_=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this))).setValues(e),n.colorInit=n.color.clone(),n.opacityInit=n.opacity,n.side=I.FrontSide,n.depthWrite=!1,n.transparent=!0,n.depthTest=!1,n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"highlight",value:function(e){e?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.colorInit),this.opacity=this.opacityInit)}}]),t}(I.MeshBasicMaterial),O=(n(12),window.$),V=window.THREE,C=function(e){function t(e){var n;Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this))).markerId=n.guid(),n.svgId=n.guid();var i='\n      <div id="'.concat(n.markerId,'" class="tooltip-marker">\n        <svg id="').concat(n.svgId,'"></svg>\n      </div>');return e.toolController.registerTool(Object(y.a)(Object(y.a)(n))),O(e.container).append(i),n.$marker=O("#".concat(n.markerId)),n.viewer=e,n.active=!1,n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"setContent",value:function(e,t){this.tooltipSelector=t,O(this.viewer.container).append(e)}},{key:"getNames",value:function(){return["Viewer.Tooltip.Tool"]}},{key:"getName",value:function(){return"Viewer.Tooltip.Tool"}},{key:"activate",value:function(){this.active||(this.active=!0,this.viewer.toolController.activateTool(this.getName()),O(this.tooltipSelector).css({display:"block"}),this.emit("activate"))}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this.viewer.toolController.deactivateTool(this.getName()),O(this.tooltipSelector).css({display:"none"}),this.pointerVisible=!1,this.$marker.css({display:"none"}),this.emit("deactivate"))}},{key:"handleSingleClick",value:function(e,t){return!1}},{key:"handleMouseMove",value:function(e){var t=O(this.viewer.container).offset();O(this.tooltipSelector).css({top:e.clientY-t.top-30+"px",left:e.clientX-t.left+"px"});var n={x:e.clientX,y:e.clientY};if(this.screenToWorld(n)&&this.active){var i=O(this.viewer.container).offset();this.$marker.css({left:n.x-i.left-this.$marker.width()/2,top:n.y-i.top-this.$marker.height()/2,display:"block"}),this.pointerVisible||(this.pointerVisible=!0,this.animateId=this.guid())}else this.pointerVisible=!1,this.$marker.css({display:"none"});return!1}},{key:"screenToWorld",value:function(e){var t=this.viewer.navigation.getScreenViewport(),n={x:(e.x-t.left)/t.width,y:(e.y-t.top)/t.height};return this.viewer.utilities.getHitPoint(n.x,n.y)}},{key:"worldToScreen",value:function(e,t){var n=new V.Vector4;n.x=e.x,n.y=e.y,n.z=e.z,n.w=1,n.applyMatrix4(t.matrixWorldInverse),n.applyMatrix4(t.projectionMatrix),n.w>0&&(n.x/=n.w,n.y/=n.w,n.z/=n.w);var i=this._viewer.impl.viewportToClient(n.x,n.y);return i.x=Math.floor(i.x)+.5,i.y=Math.floor(i.y)+.5,i}},{key:"handleKeyDown",value:function(e,t){return!1}}]),t}(g),j=n(14),G=(n(26),n(27),window.Autodesk),A=window.$;var S=function(e){function t(e,n){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object(d.a)(this,t),(i=Object(m.a)(this,Object(v.a)(t).call(this,e,t.guid(),n,Object.assign({shadow:!0,movable:!0,closable:!0},o))))._dialogResult="CANCEL",i._isVisible=!1,i._isMinimized=!1,i._btnElement=o.buttonElement,i}return Object(f.a)(t,e),Object(p.a)(t,null,[{key:"guid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxx",t=(new Date).getTime(),n=e.replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return n}}]),Object(p.a)(t,[{key:"htmlContent",value:function(e){return"<div></div>"}},{key:"unload",value:function(){this.setVisible(!1),A(this.container).remove()}},{key:"isVisible",value:function(){return this._isVisible}},{key:"setVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&A(this.container).velocity({rotateY:[0,-90]}),e!==this._isVisible&&"undefined"!==typeof this._events&&this.emit(e?"open":"close",{result:this._dialogResult}),this._isVisible=e,this._btnElement&&(e?this._btnElement.classList.add("active"):this._btnElement.classList.remove("active")),Object(j.a)(Object(v.a)(t.prototype),"setVisible",this).call(this,e)}},{key:"toggleVisibility",value:function(){this.setVisible(!this._isVisible)}},{key:"initialize",value:function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),A(this.container).append(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.options.movable&&this.initializeMoveHandlers(this.title),this.options.closable&&(this.closer=this.createCloseButton(),A(this.title).append(this.closer));var e=A(this.htmlContent(this.container.id));this.content=e[0],A(this.container).append(e),this.container.classList.add("toolPanelBase")}},{key:"createTitleBar",value:function(e){var n=this,i=document.createElement("div");i.className="dockingPanelTitle",this.titleTextId=t.guid(),this.titleImgId=t.guid();var o='\n      <span id="'.concat(this.titleImgId,'"></span>\n      <div id="').concat(this.titleTextId,'" class="dockingPanelTitleText">\n        ').concat(e,"\n      </div>\n    ");return A(i).append(o),this.addEventListener(i,"click",function(e){n.movedSinceLastClick||n.onTitleClick(e),n.movedSinceLastClick=!1}),this.addEventListener(i,"dblclick",function(e){n.onTitleDoubleClick(e)}),i}},{key:"setTitle",value:function(e,t){t&&t.localizeTitle?(A("#".concat(this.titleTextId)).attr("data-i18n",e),e=G.Viewing.i18n.translate(e)):A("#".concat(this.titleTextId)).removeAttr("data-i18n"),A("#".concat(this.titleTextId)).text(e)}},{key:"onTitleDoubleClick",value:function(e){this._isMinimized=!this._isMinimized,this._isMinimized?(this._height=A(this.container).css("height"),A(this.container).css({"min-height":"32px",overflow:"hidden",height:"32px"})):A(this.container).css({height:this._height,"min-height":"100px",overflow:"visible"})}}]),t}(g.Composer(G.Viewing.UI.DockingPanel)),L=function(e){function t(e){var n,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Object(d.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this));var o=Object(y.a)(Object(y.a)(n)),r=R();n._inputId=R();var a='\n        <p class="onoffswitch">\n          <input id="'.concat(n._inputId,'" type="checkbox" name="onoffswitch"\n            class="onoffswitch-checkbox" ').concat(i?"checked":"",'>\n          <label id="').concat(r,'" class="onoffswitch-label">\n            <span class="onoffswitch-inner"></span>\n            <span class="onoffswitch-switch"></span>\n          </label>\n        </p>\n      ');return u()(e).append(a),u()("#"+r).click(function(e){var t=u()("#"+n._inputId)[0];t.checked=!t.checked,o.emit("checked",t.checked)}),n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"checked",value:function(){return u()("#"+this._inputId)[0].checked}},{key:"setChecked",value:function(e){u()("#"+this._inputId).prop("checked",e),this.emit("checked",e)}}]),t}(g);function R(){var e=(new Date).getTime();return"xxxx-xxxx-xxxx-xxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)})}u()('<style type="text/css">\n\n  .onoffswitch {\n    position: relative; width: 50px;\n    -webkit-user-select:none; -moz-user-select:none; -ms-user-select: none;\n  }\n  .onoffswitch-checkbox {\n    display: none;\n  }\n  .onoffswitch-label {\n    display: block; overflow: hidden; cursor: pointer;\n    border: 2px solid #999999; border-radius: 8px;\n  }\n  .onoffswitch-inner {\n    display: block; width: 200%; margin-left: -100%;\n    transition: margin 0.3s ease-in 0s;\n  }\n  .onoffswitch-inner:before, .onoffswitch-inner:after {\n    display: block;\n    float: left;\n    width: 50%;\n    height: 15px;\n    padding: 0;\n    line-height: 15px;\n    font-size: 10px;\n    color: white;\n    font-family: Trebuchet, Arial, sans-serif;\n    font-weight: bold;\n    box-sizing: border-box;\n  }\n  .onoffswitch-inner:before {\n    content: "ON";\n    background-color: #0E8200;\n    color: #FFFFFF;\n  }\n  .onoffswitch-inner:after {\n    content: "OFF";\n    padding-right: 10px;\n    background-color: #d9534f;\n    color: #FFFFFF;\n    text-align: right;\n  }\n  .onoffswitch-switch {\n    display: block;\n    width: 12px;\n    margin: 2px;\n    background: #FFFFFF;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    right: 31px;\n    border: 2px solid #999999;\n    border-radius: 8px;\n    transition: all 0.3s ease-in 0s;\n  }\n  .onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-inner {\n    margin-left: 0;\n  }\n  .onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-switch {\n    right: -1px;\n  }\n</style>').appendTo("head");var F=L,D=function(e){function t(){return Object(d.a)(this,t),Object(m.a)(this,Object(v.a)(t).call(this))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"showPayload",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_blank",n=document.createElement("a");n.target=t,n.href=e,n.click()}},{key:"guid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxx",t=(new Date).getTime(),n=e.replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return n}}],[{key:"guid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxx",t=(new Date).getTime(),n=e.replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return n}}]),t}(g),Y=(n(29),window.$);function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxx",t=(new Date).getTime();return e.replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)})}var X=function(e){function t(e){var n;Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this))).dropdownId=N(),n.buttonId=N(),n.labelId=N(),n.listId=N(),n.opts=e,n.currentItem=null,n.title=e.title||"Select Item: ";var i='\n      <div id="'.concat(n.dropdownId,'" class="dropdown lmv-dropdown">\n      <button id="').concat(n.buttonId,'" class="btn dropdown-toggle"\n        type="button"\n        data-toggle="dropdown" disabled>\n        <div class="label-container">\n          <label id="').concat(n.labelId,'" class="label">').concat(n.title,'</label>\n        </div>\n        <span class="caret"></span>\n      </button>\n      <ul id="').concat(n.listId,'" class="dropdown-menu scrollable-menu">\n      </ul>\n      </div>\n    ');Y(e.container).append(i),Y("#"+n.dropdownId).css(e.pos),e.menuItems=e.menuItems||[];var o=e.prompt||n.title+": "+e.menuItems[e.selectedItemIdx||0].name;return Y("#"+n.labelId).text(o),e.menuItems.forEach(function(e){n.addItem(e)}),n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"addItem",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Y("#"+this.buttonId).prop("disabled",!1);var i=e.id||N(),o='\n      <li id="'.concat(i,'">\n        <a href="">').concat(e.name,"</a>\n      </li>");Y("#"+this.listId).append(o);var r=function(n){n&&n.preventDefault(),t.currentItem=e;t.emit("item.selected",e);e.handler&&e.handler(),Y("#"+t.labelId).text(t.title+": "+e.name)};Y("#"+i).click(function(e){r(e)}),n&&r()}},{key:"setCurrentItem",value:function(e){this.currentItem=e,Y("#"+this.labelId).text(this.title+": "+e.name)}},{key:"setItems",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(Y("#".concat(this.listId," li")).remove(),n<0)Y("#"+this.labelId).text(this.opts.prompt);else{var i=this.title+": "+e[n].name;Y("#"+this.labelId).text(i)}e.forEach(function(e){t.addItem(e)})}},{key:"removeCurrentItem",value:function(){this.currentItem&&(Y("#"+this.currentItem.id).remove(),0===Y("#"+this.listId+" > li").length&&Y("#"+this.buttonId).prop("disabled",!0),this.currentItem=null),Y("#"+this.labelId).text(this.title),this.emit("item.selected",null)}},{key:"removeItem",value:function(e){this.currentItem&&this.currentItem.id===e.id&&(Y("#"+this.labelId).text(this.title),this.currentItem=null),Y("#"+e.id).remove(),0===Y("#"+this.listId+" > li").length&&Y("#"+this.buttonId).prop("disabled",!0)}},{key:"setVisible",value:function(e){Y("#"+this.dropdownId).css({display:e?"block":"none"})}},{key:"setPosition",value:function(e){Y("#"+this.dropdownId).css(opts.pos)}},{key:"open",value:function(){Y("#"+this.dropdownId).addClass("open"),Y("#"+this.dropdownId).trigger("click.bs.dropdown")}},{key:"clear",value:function(){Y("#"+this.buttonId).prop("disabled",!0),Y("#".concat(this.listId," li")).remove(),this.currentItem=null}}]),t}(D),Z=(window.Autodesk,window.THREE),B=window.$,W=function(e){function t(e,n){var i;Object(d.a)(this,t),i=Object(m.a)(this,Object(v.a)(t).call(this,e.container,"Transform Models",{buttonElement:n,closable:!0,movable:!0,shadow:!0})),B(i.container).addClass("model-transformer"),i.dropdown=new X({container:"#"+i.dropdownContainerId,title:"Select Model",prompt:"Select Model ...",pos:{top:0,left:0}}),i.dropdown.on("item.selected",function(e){i.currentModel=e,e&&(i.setTransform(e.transform),i.emit("model.selected",{fitToView:!0,model:e}))});var o=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e),i.txTool.clearSelection(),i.rxTool.clearSelection(),e&&i.emit("model.transform",{model:e,fitToView:t,transform:{translation:i.getTranslation(),rotation:i.getRotation(),scale:i.getScale()}})};i.applyTransform=o,i.fullTransformSwitch=new F("#".concat(i.container.id,"-full-transform-switch")),i.fullTransform=!0,i.fullTransformSwitch.on("checked",function(e){i.txTool.fullTransform=e,i.rxTool.fullTransform=e,i.fullTransform=e,i.txTool.clearSelection(),i.rxTool.clearSelection()}),B("#".concat(i.container.id,"-unload-btn")).click(function(){i.txTool.clearSelection(),i.currentModel&&(i.emit("model.delete",{model:i.currentModel}),i.dropdown.removeCurrentItem())}),i.viewer=e,i.txTool=new T(e),i.rxTool=new P(e),i.txTool.fullTransform=!0,i.rxTool.fullTransform=!0,i.viewer.toolController.registerTool(i.txTool),i.viewer.toolController.registerTool(i.rxTool),i.txTool.on("transform.translate",function(e){e.model.transform.translation=e.translation,i.setTranslation(e.model.transform.translation)}),i.rxTool.on("transform.rotate",function(e){e.model.transform.rotation=e.rotation,i.setRotation({x:180*e.rotation.x/Math.PI%360,y:180*e.rotation.y/Math.PI%360,z:180*e.rotation.z/Math.PI%360})});var r=function(e){B("#"+i.transPickBtnId).prop("disabled",!i.txTool.active),i.dropdown.setCurrentItem(e.model),i.setTransform(e.model.transform),i.currentModel=e.model,i.emit("model.selected",{model:e.model,fitToView:!1}),i.tooltip.deactivate()};return i.txTool.on("transform.modelSelected",r),i.txTool.on("transform.clearSelection",function(){B("#"+i.transPickBtnId).prop("disabled",!0),i.tooltip.deactivate()}),i.rxTool.on("transform.modelSelected",r),i.on("open",function(){i.viewer.toolController.activateTool(i.txTool.getName())}),i.on("close",function(){i.viewer.toolController.deactivateTool(i.txTool.getName()),i.viewer.toolController.deactivateTool(i.rxTool.getName()),B("#"+i.transPickBtnId).prop("disabled",!0)}),B(".model-transformer .trans, .model-transformer .rot").on("change keyup input paste",function(){o(i.currentModel)}),B(".model-transformer .trans").on("focus",function(){i.viewer.toolController.deactivateTool(i.rxTool.getName()),i.viewer.toolController.activateTool(i.txTool.getName())}),B(".model-transformer .rot").on("focus",function(){i.viewer.toolController.deactivateTool(i.txTool.getName()),i.viewer.toolController.activateTool(i.rxTool.getName())}),B("#".concat(i.container.id,"-Sx")).on("change keyup",function(){var e=B("#".concat(i.container.id,"-Sx")).val();B("#".concat(i.container.id,"-Sy")).val(e),B("#".concat(i.container.id,"-Sz")).val(e),o(i.currentModel,!0)}),B("#"+i.transPickBtnId).click(function(){i.txTool.onPick(),i.tooltip.activate()}),i.tooltip=new C(e),i.tooltip.setContent('\n      <div id="pickTooltipId" class="pick-tooltip">\n        <b>Pick position ...</b>\n      </div>',"#pickTooltipId"),i}return Object(f.a)(t,e),Object(p.a)(t,[{key:"htmlContent",value:function(e){return this.dropdownContainerId=S.guid(),this.transPickBtnId=S.guid(),'\n\n      <div class="container">\n\n         <div id="'.concat(this.dropdownContainerId,'">\n        </div>\n\n        <hr class="v-spacer">\n\n        <span class="text-span">\n            Snap:\n          </span>\n\n          <hr class="v-spacer">\n\n        <button id="').concat(this.transPickBtnId,'"\n            class="btn btn-trans-pick" disabled>\n            <span class="glyphicon glyphicon-screenshot btn-span">\n            </span>\n          </button>\n\n        <hr class="v-spacer">\n\n        <div>\n\n          <span class="text-span">\n            Translation:\n          </span>\n\n          <hr class="v-spacer">\n\n          \n\n          <input id="').concat(e,'-Tx" type="text"\n            class="input numeric trans"\n            placeholder="  x (0.0)">\n\n          <input id="').concat(e,'-Ty" type="text"\n            class="input numeric trans"\n            placeholder="  y (0.0)">\n\n          <input id="').concat(e,'-Tz" type="text"\n            class="input numeric trans"\n            placeholder="  z (0.0)">\n\n          <hr class="v-spacer">\n\n          <span class="text-span">\n            Rotation (deg):\n          </span>\n\n          <hr class="v-spacer">\n\n          <input id="').concat(e,'-Rx" type="text"\n            class="input numeric rot"\n            placeholder="  x (0.0)">\n\n          <input id="').concat(e,'-Ry" type="text"\n            class="input numeric rot"\n            placeholder="  y (0.0)">\n\n          <input id="').concat(e,'-Rz" type="text"\n            class="input numeric rot"\n            placeholder="  z (0.0)">\n\n          <span class="text-span">\n            Scale:\n          </span>\n\n          <hr class="v-spacer">\n\n          <input id="').concat(e,'-Sx" type="text"\n            class="input numeric scale"\n            placeholder="  x (1.0)">\n\n          <input id="').concat(e,'-Sy" type="text"\n            class="input numeric scale"\n            placeholder="  y (1.0)">\n\n          <input id="').concat(e,'-Sz" type="text"\n            class="input numeric scale"\n            placeholder="  z (1.0)">\n\n          <hr class="v-spacer-large">\n\n        </div>\n\n        <div style="margin-top:8px">\n\n          <div style="color:white;">\n          Full Model Transform\n            <div id="').concat(e,'-full-transform-switch"\n              style="float:left; margin-right:8px;">\n            </div>\n          </div>\n\n          <hr class="v-spacer-large">\n\n          <button class="btn btn-danger" id="').concat(e,'-unload-btn">\n            <span class="glyphicon glyphicon-save-file btn-span">\n            </span>\n             Unload Model\n          </button>\n        </div>\n\n      </div>')}},{key:"setTransform",value:function(e){B("#".concat(this.container.id,"-Tx")).val(e.translation.x.toFixed(2)),B("#".concat(this.container.id,"-Ty")).val(e.translation.y.toFixed(2)),B("#".concat(this.container.id,"-Tz")).val(e.translation.z.toFixed(2)),B("#".concat(this.container.id,"-Rx")).val(e.rotation.x.toFixed(2)),B("#".concat(this.container.id,"-Ry")).val(e.rotation.y.toFixed(2)),B("#".concat(this.container.id,"-Rz")).val(e.rotation.z.toFixed(2)),B("#".concat(this.container.id,"-Sx")).val(e.scale.x),B("#".concat(this.container.id,"-Sy")).val(e.scale.y),B("#".concat(this.container.id,"-Sz")).val(e.scale.z)}},{key:"getScale",value:function(){var e=parseFloat(B("#".concat(this.container.id,"-Sx")).val()),t=parseFloat(B("#".concat(this.container.id,"-Sy")).val()),n=parseFloat(B("#".concat(this.container.id,"-Sz")).val());return e=isNaN(e)?1:e,t=isNaN(t)?1:t,n=isNaN(n)?1:n,new Z.Vector3(e,t,n)}},{key:"getTranslation",value:function(){var e=parseFloat(B("#".concat(this.container.id,"-Tx")).val()),t=parseFloat(B("#".concat(this.container.id,"-Ty")).val()),n=parseFloat(B("#".concat(this.container.id,"-Tz")).val());return e=isNaN(e)?0:e,t=isNaN(t)?0:t,n=isNaN(n)?0:n,new Z.Vector3(e,t,n)}},{key:"getRotation",value:function(){var e=parseFloat(B("#".concat(this.container.id,"-Rx")).val()),t=parseFloat(B("#".concat(this.container.id,"-Ry")).val()),n=parseFloat(B("#".concat(this.container.id,"-Rz")).val());return e=isNaN(e)?0:e,t=isNaN(t)?0:t,n=isNaN(n)?0:n,new Z.Vector3(e,t,n)}},{key:"setScale",value:function(e){B("#".concat(this.container.id,"-Sx")).val(e.x.toFixed(2)),B("#".concat(this.container.id,"-Sy")).val(e.y.toFixed(2)),B("#".concat(this.container.id,"-Sz")).val(e.z.toFixed(2))}},{key:"setTranslation",value:function(e){B("#".concat(this.container.id,"-Tx")).val(e.x.toFixed(2)),B("#".concat(this.container.id,"-Ty")).val(e.y.toFixed(2)),B("#".concat(this.container.id,"-Tz")).val(e.z.toFixed(2))}},{key:"setRotation",value:function(e){B("#".concat(this.container.id,"-Rx")).val(e.x.toFixed(2)),B("#".concat(this.container.id,"-Ry")).val(e.y.toFixed(2)),B("#".concat(this.container.id,"-Rz")).val(e.z.toFixed(2))}},{key:"clearSelection",value:function(){this.txTool.clearSelection(),this.rxTool.clearSelection()}}]),t}(S),Q=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(d.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e,i)))._viewer=e,n._options=i,n._events={},n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"load",value:function(){return!0}},{key:"unload",value:function(){return!0}},{key:"on",value:function(e,t){return this._events[e]=this._events[e]||[],this._events[e].push(t),t}},{key:"off",value:function(e,t){e in this._events!==!1&&this._events[e].splice(this._events[e].indexOf(t),1)}},{key:"emit",value:function(e){if(void 0!==this._events[e])for(var t=this._events[e].slice(),n=0;n<t.length;++n){var i=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==i)return i}}}],[{key:"guid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxx",t=(new Date).getTime(),n=e.replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return n}},{key:"ExtensionId",get:function(){return"Viewing.Extension.Base"}}]),t}(window.Autodesk.Viewing.Extension),U=n(10),H=window.Autodesk,q=window.THREE,J=function(){function e(){Object(d.a)(this,e)}return Object(p.a)(e,null,[{key:"guid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxxxx",t=(new Date).getTime(),n=e.replace(/[xy]/g,function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)});return n}},{key:"getDefaultViewablePath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["3d","2d"],n=e.getRootItem(),i=Object(U.a)(t),o=[];return i.forEach(function(e){o=Object(U.a)(o).concat(Object(U.a)(H.Viewing.Document.getSubItemsWithProperties(n,{type:"geometry",role:e},!0)))}),o.length?e.getViewablePath(o[0]):null}},{key:"createButton",value:function(e,t,n,i){var o=new H.Viewing.UI.Button(e);return o.icon.style.fontSize="24px",o.icon.className=t,o.setToolTip(n),o.onClick=i,o}},{key:"createControlGroup",value:function(e,t){var n=e.getToolbar(!0);if(n){var i=new H.Viewing.UI.ControlGroup(t);return n.addControl(i),i}}},{key:"getLeafNodes",value:function(e,t){return new Promise(function(n,i){try{var o=e.getData().instanceTree;t=t||o.getRootId();for(var r=Array.isArray(t)?t:[t],a=[],s=function e(t){var n=0;o.enumNodeChildren(t,function(t){e(t),++n}),0==n&&a.push(t)},l=0;l<r.length;++l)s(r[l]);return n(a)}catch(c){return i(c)}})}},{key:"getFragIds",value:function(t,n){return new Promise(function(){var i=Object(c.a)(l.a.mark(function i(o,r){var a,s;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.delegateYield(l.a.mark(function i(){var r,s,c,h;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return r=Array.isArray(n)?n:[n],s=t.getData().instanceTree,i.next=4,e.getLeafNodes(t,r);case 4:for(c=i.sent,h=[],a=0;a<c.length;++a)s.enumNodeFragments(c[a],function(e){h.push(e)});return i.abrupt("return",{v:o(h)});case 8:case"end":return i.stop()}},i,this)})(),"t0",2);case 2:if("object"!==typeof(s=i.t0)){i.next=5;break}return i.abrupt("return",s.v);case 5:i.next=10;break;case 7:return i.prev=7,i.t1=i.catch(0),i.abrupt("return",r(i.t1));case 10:case"end":return i.stop()}},i,this,[[0,7]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getWorldBoundingBox",value:function(t,n){return new Promise(function(){var i=Object(c.a)(l.a.mark(function i(o,r){var a,s,c,h;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,e.getFragIds(t,n);case 3:if((a=i.sent).length){i.next=6;break}return i.abrupt("return",r("No geometry, invalid dbId?"));case 6:return s=t.getFragmentList(),c=new q.Box3,h=new q.Box3,a.forEach(function(e){s.getWorldBounds(e,c),h.union(c)}),i.abrupt("return",o(h));case 13:return i.prev=13,i.t0=i.catch(0),i.abrupt("return",r(i.t0));case 16:case"end":return i.stop()}},i,this,[[0,13]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getProperties",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(o,r){try{if(i){var a=i.map(function(i){return e.getProperty(t,n,i,"Not Available")});Promise.all(a).then(function(e){o(e)})}else t.getProperties(n,function(e){return e.properties?o(e.properties):r("No Properties")})}catch(s){return console.log(s),r(s)}})}},{key:"getProperty",value:function(e,t,n,i){return new Promise(function(o,r){try{e.getProperties(t,function(e){if(e.properties){if(e.properties.forEach(function(e){e.dbId=t,"function"===typeof n?n(e.displayName)&&o(e):n===e.displayName&&o(e)}),i)return o({displayValue:i,displayName:n,dbId:t});r(new Error("Not Found"))}else r(new Error("Error getting properties"))})}catch(a){return r(a)}})}},{key:"getPropertyList",value:function(t,n){return new Promise(function(){var i=Object(c.a)(l.a.mark(function i(o,r){var a,s,c;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,a=n.map(function(n){return e.getProperties(t,n)}),i.next=4,Promise.all(a);case 4:return s=i.sent,c=[],s.forEach(function(e){e.forEach(function(e){c.indexOf(e.displayName)<0&&c.push(e.displayName)})}),i.abrupt("return",o(c.sort()));case 10:return i.prev=10,i.t0=i.catch(0),i.abrupt("return",r(i.t0));case 13:case"end":return i.stop()}},i,this,[[0,10]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"getBulkPropertiesAsync",value:function(e,t,n){var i=this;return new Promise(function(){var o=Object(c.a)(l.a.mark(function o(r,a){var s,c,h;return l.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if("function"!==typeof n){o.next=9;break}return s=t.map(function(t){return i.getProperty(e,t,n,"Not Found")}),o.next=4,Promise.all(s);case 4:c=o.sent,h=c.filter(function(e){return"Not Found"!==e.displayValue}),r(h.map(function(e){return{properties:[e],dbId:e.dbId}})),o.next=10;break;case 9:e.getBulkProperties(t,n,function(e){r(e)},function(e){a(e)});case 10:case"end":return o.stop()}},o,this)}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"mapComponentsByProp",value:function(t,n,i,o){return new Promise(function(){var o=Object(c.a)(l.a.mark(function o(r,a){var s,c,h;return l.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,e.getBulkPropertiesAsync(t,i,n);case 3:return s=o.sent,c=s.map(function(e){return Object.assign({},e.properties[0],{dbId:e.dbId})}),h={},c.forEach(function(e){var t=e.displayValue;"string"==typeof t&&(t=t.split(":")[0]),h[t]||(h[t]=[]),h[t].push(e.dbId)}),o.abrupt("return",r(h));case 10:return o.prev=10,o.t0=o.catch(0),o.abrupt("return",a(o.t0));case 13:case"end":return o.stop()}},o,this,[[0,10]])}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"runTaskOnDataTree",value:function(e,t){var n=[];return function e(i){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i.children&&i.children.forEach(function(t){e(t,i)});var r=t(i,o);n.push(r)}(e),Promise.all(n)}},{key:"drawBox",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i||(i=new q.LineBasicMaterial({color:16776960,linewidth:2}),e.impl.matman().addMaterial("ADN-Material-Line",i,!0));var o=function(t,n){for(var i=[],o=0;o<t.length;o+=2){var r=t[o],a=t[o+1],s=new q.Geometry;s.vertices.push(new q.Vector3(r.x,r.y,r.z)),s.vertices.push(new q.Vector3(a.x,a.y,a.z)),s.computeLineDistances();var l=new q.Line(s,n);e.impl.scene.add(l),i.push(l)}return i}([{x:t.x,y:t.y,z:t.z},{x:n.x,y:t.y,z:t.z},{x:n.x,y:t.y,z:t.z},{x:n.x,y:t.y,z:n.z},{x:n.x,y:t.y,z:n.z},{x:t.x,y:t.y,z:n.z},{x:t.x,y:t.y,z:n.z},{x:t.x,y:t.y,z:t.z},{x:t.x,y:n.y,z:n.z},{x:n.x,y:n.y,z:n.z},{x:n.x,y:n.y,z:n.z},{x:n.x,y:n.y,z:t.z},{x:n.x,y:n.y,z:t.z},{x:t.x,y:n.y,z:t.z},{x:t.x,y:n.y,z:t.z},{x:t.x,y:n.y,z:n.z},{x:t.x,y:t.y,z:t.z},{x:t.x,y:n.y,z:t.z},{x:n.x,y:t.y,z:t.z},{x:n.x,y:n.y,z:t.z},{x:n.x,y:t.y,z:n.z},{x:n.x,y:n.y,z:n.z},{x:t.x,y:t.y,z:n.z},{x:t.x,y:n.y,z:n.z}],i);return e.impl.sceneUpdated(!0),o}},{key:"setMaterial",value:function(){var t=Object(c.a)(l.a.mark(function t(n,i,o){var r,a;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getFragIds(n,i);case 2:r=t.sent,a=n.getFragmentList(),r.forEach(function(e){a.setMaterial(e,o)});case 5:case"end":return t.stop()}},t,this)}));return function(e,n,i){return t.apply(this,arguments)}}()},{key:"buildModelTree",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;var n=e.getData().instanceTree,i=n.getRootId(),o={dbId:i,name:n.getNodeName(i)};return function e(i){n.enumNodeChildren(i.dbId,function(o){var r=null;t?r=t(o):(i.children=i.children||[],r={dbId:o,name:n.getNodeName(o)},i.children.push(r)),e(r)})}(o),o}},{key:"executeTaskOnModelTree",value:function(e,t){var n=[];var i=e.getData().instanceTree;return function o(r){i.enumNodeChildren(r,function(i){n.push(t(e,i)),o(i)})}(i.getRootId()),n}},{key:"isolateFull",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new Promise(function(){var o=Object(c.a)(l.a.mark(function o(r,a){var s,c,h,u;return l.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,n=n||t.model,t.isolate(i),s=Array.isArray(i)?i:[i],o.next=6,e.getLeafNodes(n,s);case 6:return c=o.sent,o.next=9,e.getLeafNodes(n);case 9:return h=o.sent,u=h.map(function(e){return new Promise(function(n){var i=!c.length||c.indexOf(e)>-1;t.impl.visibilityManager.setNodeOff(e,!i),n()})}),o.abrupt("return",Promise.all(u));case 14:return o.prev=14,o.t0=o.catch(0),o.abrupt("return",a(o.t0));case 17:case"end":return o.stop()}},o,this,[[0,14]])}));return function(e,t){return o.apply(this,arguments)}}())}},{key:"mobile",get:function(){return{getUserAgent:function(){return navigator.userAgent},isAndroid:function(){return this.getUserAgent().match(/Android/i)},isBlackBerry:function(){return this.getUserAgent().match(/BlackBerry/i)},isIOS:function(){return this.getUserAgent().match(/iPhone|iPad|iPod/i)},isOpera:function(){return this.getUserAgent().match(/Opera Mini/i)},isWindows:function(){return this.isWindowsDesktop()||this.isWindowsMobile()},isWindowsMobile:function(){return this.getUserAgent().match(/IEMobile/i)},isWindowsDesktop:function(){return this.getUserAgent().match(/WPDesktop/i)},isAny:function(){return this.isAndroid()||this.isBlackBerry()||this.isIOS()||this.isWindowsMobile()}}}}]),e}(),$=window.Autodesk,K=window.THREE,ee=function(e){function t(e,n){var i;return Object(d.a)(this,t),(i=Object(m.a)(this,Object(v.a)(t).call(this,e,n))).firstModelLoaded=null,i.modelCollection={},i.onGeometryLoadedHandler=function(e){i.onGeometryLoaded(e)},i.onAggregateSelectionChangedHandler=function(e){i.onAggregateSelectionChanged(e)},i.selectedDbIdArray=[],i}return Object(f.a)(t,e),Object(p.a)(t,[{key:"load",value:function(){var e=this;this.loadControls();var t=$.Viewing.theHotkeyManager;this.hotkeysId=Q.guid();var n={keycodes:[t.KEYCODES.t],onPress:function(e){return!0},onRelease:function(t){var n=null;if(e.panel.rxTool.active&&(n=e.panel.rxTool.hitPoint(),e._viewer.toolController.deactivateTool(e.panel.rxTool.getName())),!e.panel.txTool.active&&(e._viewer.toolController.activateTool(e.panel.txTool.getName()),n)){e.panel.txTool.setHitPoint(n);var i=e._viewer.getAggregateSelection();if(i.length){var o=i[0].model,r=i[0].selection;J.getFragIds(o,r).then(function(t){e.panel.txTool.setSelection({fragIdsArray:t,dbIdArray:r,model:o})})}}return!0}},i={keycodes:[t.KEYCODES.r],onPress:function(e){return!0},onRelease:function(t){var n=null;if(e.panel.txTool.active&&(n=e.panel.txTool.hitPoint(),e._viewer.toolController.deactivateTool(e.panel.txTool.getName())),!e.panel.rxTool.active&&(e._viewer.toolController.activateTool(e.panel.rxTool.getName()),n)){e.panel.rxTool.setHitPoint(n);var i=e._viewer.getAggregateSelection();if(i.length){var o=i[0].model,r=i[0].selection;J.getFragIds(o,r).then(function(t){e.panel.rxTool.setSelection({fragIdsArray:t,dbIdArray:r,model:o})})}}return!0}};return t.pushHotkeys(this.hotkeysId,[n,i],{tryUntilSuccess:!0}),this._viewer.addEventListener($.Viewing.GEOMETRY_LOADED_EVENT,this.onGeometryLoadedHandler),this._viewer.addEventListener($.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChangedHandler),console.log("Viewing.Extension.ModelTransformer loaded"),!0}},{key:"loadControls",value:function(){var e=this;if(this.control=J.createButton("toolbar-model-transformer","adsk-button-icon model-transformer-icon fa fa-gears","Transform Models",function(){e.panel.toggleVisibility()}),this.panel=new W(this._viewer,this.control.container),this.panel.on("open",function(){e._options.autoLoad&&e._viewer.impl.modelQueue().getModels().forEach(function(t){t.modelId=t.modelId||Q.guid(),e.modelCollection[t.modelId]||(t.name=t.name||"Model "+(Object.keys(e.modelCollection).length+1),e.addModel(t))})}),this.panel.on("model.transform",function(t){t.model.transform=t.transform,e.applyTransform(t.model),e._viewer.impl.sceneUpdated(!0)}),this.panel.on("model.delete",function(t){e.deleteModel(t.model),e._viewer.impl.sceneUpdated(!0)}),this.panel.on("model.selected",function(t){e.currentSelection=t.selection}),this._options.parentControl)"string"===typeof this._options.parentControl?this.parentControl=this._viewer.getToolbar().getControl(this._options.parentControl):"object"===typeof this._options.parentControl&&(this.parentControl=this._options.parentControl);else{var t=this._viewer.getToolbar(!0);this.parentControl=new $.Viewing.UI.ControlGroup("model-transformer"),t.addControl(this.parentControl)}this.parentControl&&this.parentControl.addControl(this.control)}},{key:"onGeometryLoaded",value:function(e){if(this._options.autoLoad){var t=e.model;t.modelId=t.modelId||Q.guid(),this.modelCollection[t.modelId]||(t.name=t.name||"Model "+(Object.keys(this.modelCollection).length+1),this.addModel(t))}}},{key:"unload",value:function(){return $.Viewing.theHotkeyManager.popHotkeys(this.hotkeysId),this._viewer.removeEventListener($.Viewing.GEOMETRY_LOADED_EVENT,this.onGeometryLoadedHandler),this._viewer.removeEventListener($.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,this.onAggregateSelectionChangedHandler),this.control&&this.parentControl.removeControl(this.control),console.log("Viewing.Extension.ModelTransfomer unloaded"),!0}},{key:"onAggregateSelectionChanged",value:function(e){if(e.selections&&e.selections.length){var t=e.selections[0];this.selectedDbIdArray=e.selections[0].dbIdArray,this.setStructure(t.model)}}},{key:"applyTransform",value:function(e){var t=this._viewer,n=new K.Euler(e.transform.rotation.x*Math.PI/180,e.transform.rotation.y*Math.PI/180,e.transform.rotation.z*Math.PI/180,"XYZ"),i=new K.Quaternion;function o(n){var o=t.impl.getFragmentProxy(e,n);o.getAnimTransform(),o.position=e.transform.translation,o.scale=e.transform.scale,o.quaternion._x=i.x,o.quaternion._y=i.y,o.quaternion._z=i.z,o.quaternion._w=i.w,o.updateAnimTransform()}i.setFromEuler(n);for(var r=e.getFragmentList().fragments.fragId2dbId.length,a=0;a<r;++a)o(a)}},{key:"fitModelToView",value:function(e){var t=e.getData().instanceTree;if(t){var n=t.getRootId();this._viewer.model=e,this._viewer.fitToView([n])}}},{key:"setStructure",value:function(e){var t=e.getData().instanceTree;t&&this._viewer.modelstructure&&this._viewer.modelstructure.setModel(t)}},{key:"addModel",value:function(e){this.modelCollection[e.modelId]=e,e.transform||(e.transform={scale:{x:1,y:1,z:1},translation:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}),this.panel.dropdown.addItem(e,!0)}},{key:"modelTransformToMatrix",value:function(e){var t=new K.Matrix4,n=new K.Vector3(e.translation.x,e.translation.y,e.translation.z),i=new K.Euler(e.rotation.x*Math.PI/180,e.rotation.y*Math.PI/180,e.rotation.z*Math.PI/180,"XYZ"),o=new K.Quaternion;o.setFromEuler(i);var r=new K.Vector3(e.scale.x,e.scale.y,e.scale.z);return t.compose(n,o,r),t}},{key:"buildPlacementTransform",value:function(e){var t=new K.Matrix4;this.firstModelLoaded||(this.firstModelLoaded=e);var n=["rvt","nwc"],i=this.firstModelLoaded.split(".").pop(-1),o=e.split(".").pop(-1);return n.indexOf(i)>-1?n.indexOf(o)<0&&t.makeRotationX(90*Math.PI/180):n.indexOf(o)>-1&&t.makeRotationX(-90*Math.PI/180),t}},{key:"deleteModel",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];delete this.modelCollection[e.modelId],0===Object.keys(this.modelCollection).length&&(this.firstModelLoaded=null),t&&this.emit("model.delete",e),this._viewer.impl.unloadModel(e)}},{key:"clearModels",value:function(){this.panel.clearSelection(),this.panel.dropdown.clear(),this.modelCollection={}}}],[{key:"ExtensionId",get:function(){return"Viewing.Extension.ModelTransformer"}}]),t}(Q);$.Viewing.theExtensionManager.registerExtension(ee.ExtensionId,ee);var te="Viewing.Extension.ModelTransformer";function ne(e){for(var t=function(e){for(var t=[],n=u()("<tr/>"),i=0;i<e.length;i++){var o=e[i];for(var r in o)-1===u.a.inArray(r,t)&&(t.push(r),n.append(u()("<th/>").html(r)))}return u()("#csvDataTable").append(n),t}(e),n=0;n<e.length;n++){for(var i=u()("<tr/>"),o=0;o<t.length;o++){var r=e[n][t[o]];null==r&&(r=""),i.append(u()("<td/>").html(r))}u()("#csvDataTable").append(i)}}u()("#btnDataImport").click(function(){var e;e=function(e){u()("#csvDataTable").empty(),ne(e),u()("#csvDataTable tr").click(function(){u()(this).addClass("selected").siblings().removeClass("selected");var e=u()(this).find("td:first").html();console.log(e),e})},u.a.ajax({url:"/rivetec/getrivets",success:function(t){console.log("rivets portflio",t),e(t)}})});var ie,oe,re="importCsvData",ae=window.Autodesk,se=window.THREE,le={},ce={env:"AutodeskProduction",getAccessToken:function(e){u.a.ajax({url:"/user/token",success:function(t){console.log("res de token client",t),e(t.access_token,t.expires_in)}})}};function he(e){var t=document.getElementById("forgeViewer");ie=new ae.Viewing.Private.GuiViewer3D(t),ae.Viewing.Initializer(ce,function(){var t=ie.start();t?console.error("viewer.start() error - errorCode:"+t):ae.Viewing.Document.load(e,ue,me)})}function ue(e){var t=ae.Viewing.Document.getSubItemsWithProperties(e.getRootItem(),{type:"geometry"},!0);if(0!==t.length){ie.addEventListener(ae.Viewing.GEOMETRY_LOADED_EVENT,de),ie.addEventListener(ae.Viewing.AGGREGATE_SELECTION_CHANGED_EVENT,pe),ie.prefs.tag("ignore-producer");!function(e,t,n){new Promise(function(){var i=Object(c.a)(l.a.mark(function i(o,r){var a,s,c,h,u;return l.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:a=e[n],s=t.getViewablePath(a),u={sharedPropertyDbPath:t.getPropertyDbPath()},ie.loadModel(s,u,function(e){switch("success"===t.myData.status.toString()){case"dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6bW9kZWwyMDE5LTAxLTAzLTE0LTI4LTI4LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlL0hlYWQwMS5pcHQ"===t.myData.guid.toString():(c=ie.getExtension(te).panel).setTransform(ve()),c.applyTransform(e),h="Head01.ipt";break;default:h="Body_Obal_1.ipt"}e.name=h,o(e)});case 4:case"end":return i.stop()}},i,this)}));return function(e,t){return i.apply(this,arguments)}}())}(t,e,0)}else console.error("Document contains no viewables.")}function de(e){e.target.model=e.model;var t=e.target;t.removeEventListener(ae.Viewing.GEOMETRY_LOADED_EVENT,de),t.setQualityLevel(!1,!1),t.setGroundShadow(!1),t.fitToView()}function pe(e){e.selections&&e.selections.length&&(le=ie.clientToWorld(oe.canvasX,oe.canvasY,!0))}function me(e){console.error("onDocumentLoadFailure() - errorCode:"+e)}function ve(){var e={translation:new se.Vector3(0,0,0),rotation:new se.Vector3(0,0,0),scale:new se.Vector3(1,1,1)};switch(le.face.normal.x*le.face.normal.y===0){case 0===le.face.normal.x&&1===Math.round(le.face.normal.y):e.translation=new se.Vector3(le.point.x,le.point.y+.3,le.point.z),e.rotation=new se.Vector3(0,0,180),console.log("Inside Y = 1 Wall");break;case 0===le.face.normal.x&&-1===Math.round(le.face.normal.y):e.translation=new se.Vector3(le.point.x,le.point.y-.3,le.point.z),e.rotation=new se.Vector3(0,0,0),console.log("Inside Y = -1 Wall");break;case 1===Math.round(le.face.normal.x)&&0===le.face.normal.y:e.translation=new se.Vector3(le.point.x+.3,le.point.y,le.point.z),e.rotation=new se.Vector3(90,90,0),console.log("Inside X = 1 Wall");break;case-1===Math.round(le.face.normal.x)&&0===le.face.normal.y:e.translation=new se.Vector3(le.point.x-.35,le.point.y,le.point.z),e.rotation=new se.Vector3(0,180,90),console.log("Inside X = -1 Wall");break;default:alert("You need to select one of the walls for this AC Unit")}return e}he("urn:dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6bW9kZWwyMDE4LTEyLTA1LTEwLTA0LTM3LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlL0JvZHlfT2JhbF8xLmlwdA"),u()("#addModelBtn").click(function(){!function(e){var t="";"1"===e?t="urn:dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6bW9kZWwyMDE5LTAxLTAzLTE0LTI4LTI4LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlL0hlYWQwMS5pcHQ":(t="",alert("Model s t\xedmto ID nem\xe1m v datab\xe1zi"));console.log("model URN: "+t)}(function(){var e=re.rowID;return console.log("Kliknul jsi na ADD SELECTED a rowId je: "+e),e}()),ae.Viewing.Document.load("urn:dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6bW9kZWwyMDE5LTAxLTAzLTE0LTI4LTI4LWQ0MWQ4Y2Q5OGYwMGIyMDRlOTgwMDk5OGVjZjg0MjdlL0hlYWQwMS5pcHQ",ue,me)});var fe={launchViewer:he};a.a.render(o.a.createElement("div",null,o.a.createElement("div",{class:"row center",id:"forgeViewer"}),o.a.createElement("div",{id:"openViewerBtn",class:"btn"},"BUTTON"),o.a.createElement("div",{id:"exportStepBtn",class:"btn"},"BUTTON STEP")),document.getElementById("root")),fe.launchViewer()}},[[15,2,1]]]);
//# sourceMappingURL=main.14ca31a3.chunk.js.map